#!/usr/bin/env puma

directory '<%= current_path %>'
environment '<%= fetch(:puma_env) %>'
daemonize true
pidfile "<%=fetch(:puma_pid)%>"
state_path "<%=fetch(:puma_state)%>"
stdout_redirect '<%=fetch(:puma_access_log)%>', '<%=fetch(:puma_error_log)%>', true
threads <%=fetch(:puma_threads).join(',')%>
bind "<%=fetch(:puma_bind)%>"

workers <%= puma_workers %>
preload_app!

on_restart do
  puts 'On restart...Refresh ENV["BUNDLE_GEMFILE"]'
  ENV["BUNDLE_GEMFILE"] = "<%= fetch(:bundle_gemfile, "#{release_path}/Gemfile") %>"
end

